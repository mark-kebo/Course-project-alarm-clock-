MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;*******************************************************************************
                      00002 ;                                                                              *
                      00003 ;    Filename:  ALARM CLOCK                                                    *
                      00004 ;    Date:      19.10.17                                                       *
                      00005 ;    File Version:   1.4.2                                                     *
                      00006 ;    Author:         Dmitry Vorozhbicky                                        *
                      00007 ;    Company:        GrSU                                                      *
                      00008 ;                                                                              *
                      00009 ;*******************************************************************************  
                      00010 ;processor    PIC16F877
Warning[205]: Found directive in column 1. (include)
                      00011 include  <P16F877.INC>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Jul 02 2017
                      00005 ;  MPASM PIC16F877 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2017 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00541         LIST
Warning[205]: Found directive in column 1. (errorlevel)
                      00012 errorlevel   -302
                      00013         ;  директивы  типа  контроллера,  под-
                      00014         ;ключения  заголовочного  файла  и  вы-
                      00015         ;вода сообщений об ошибках
                      00016 #define   bank0  bcf STATUS,  RP0
                      00017 #define   bank1  bsf STATUS,  RP0
                      00018 ; директивы, позволяющие заменять в
                      00019         ;теле  ПО  команды,  указанные  после
                      00020         ;этой  директивы  (bcf  ,  bsf)  –  метками
                      00021         ;bank0, bank1. Обратную замену произ-
                      00022         ;водит компилятор
  00000020            00023 WAIT                equ     0x20
  00000026            00024 fCOUNTER            equ     0x26
  00000027            00025 fCOUNTER2           equ     0x27
  00000030            00026 TIME_HH1            equ     0x30
  00000031            00027 TIME_HH2            equ     0x31
  00000032            00028 TIME_MM1            equ     0x32
  00000033            00029 TIME_MM2            equ     0x33
  00000034            00030 TIME_SS1            equ     0x34
  00000035            00031 TIME_SS2            equ     0x35
  00000036            00032 DAY                 equ     0x36
  00000037            00033 ALARM_HH1           equ     0x37
  00000038            00034 ALARM_HH2           equ     0x38
  00000039            00035 ALARM_MM1           equ     0x39
  0000003A            00036 ALARM_MM2           equ     0x3A
  0000003B            00037 Key1                equ     0x3B
  0000003C            00038 Key2                equ     0x3C
  0000003D            00039 Key3                equ     0x3D
  0000003E            00040 Key4                equ     0x3E
  0000003F            00041 Key5                equ     0x3F
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000040            00042 Key6                equ     0x40
  00000041            00043 Key7                equ     0x41
  00000042            00044 Key8                equ     0x42
  00000043            00045 Key9                equ     0x43
  00000044            00046 fCOUNTER1           equ     0x44
  00000045            00047 TEMP_TIME_HH1       equ     0x45
  00000046            00048 TEMP_TIME_HH2       equ     0x46
  00000047            00049 TEMP_TIME_MM1       equ     0x47
  00000048            00050 TEMP_TIME_MM2       equ     0x48
  00000049            00051 TEMP_TIME_SS1       equ     0x49
  0000004A            00052 TEMP_TIME_SS2       equ     0x4A
  0000004B            00053 TEMP_DAY            equ     0x4B
  0000004C            00054 TEMP_ALARM_HH1      equ     0x4C
  0000004D            00055 TEMP_ALARM_HH2      equ     0x4D
  0000004E            00056 TEMP_ALARM_MM1      equ     0x4E
  0000004F            00057 TEMP_ALARM_MM2      equ     0x4F
  00000050            00058 NumPressKey         equ     0x50
  00000051            00059 Blink               equ     0x51
                      00060     ;вспомогательные  регистры,  назначе-
                      00061         ;ние которых приведено в комментариях
  0002                00062     constant   DS = .2
  0002                00063     constant   RST = .2
                      00064         ;  директивы,  ставящие в  соответствие
                      00065         ;меткам DS  и  RST  значение  0.  Анало-
                      00066         ;гия директив equ для имен регистров.
                      00067 
                      00068 wait  macro     time
                      00069     movlw    (time/5)-1
                      00070     movwf    WAIT
                      00071     call    wait5u
                      00072     endm
                      00073         ;макрос паузы с именем wait. Особен-
                      00074         ;ность этого макроса состоит в том, что
                      00075         ;у  него  имеется  параметр  –  time.  При
                      00076         ;вызове  макроса  значение  параметра
                      00077         ;указывается  после  имени  макроса  в
                      00078         ;виде  целого  десятичного  числа  крат-
                      00079         ;ного  5  (в  данном  примере).  В  теле
                      00080         ;макроса  это  число  подставляется  в
                      00081         ;«переменную» time и далее использу-
                      00082         ;ется вычисленное значение (которое в
                      00083         ;данном случае  выступает  в  роли  кон-
                      00084         ;станты, записываемой в W). Вместе с
                      00085         ;процедурой  wait5u  длительность  за-
                      00086         ;держки,  обеспечиваемая  макросом
                      00087         ;равна time микросекунд
                      00088 
                      00089     org 0x0000
0000   0183           00090     clrf STATUS
0001   3000           00091     movlw 0x00
0002   008A           00092     movwf PCLATH
0003   2???           00093     goto begin
                      00094         ;выбор нулевой страницы памяти ко-
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00095         ;манд и размещение на ней откомпили-
                      00096         ;рованного кода
                      00097 
0004                  00098 begin
0004   1683           00099     bank1  ; выбор первого банка памяти. Для вы-
                      00100         ;зова используется метка bank1, объяв-
                      00101         ;ленная выше директивой #define
0005   308F           00102     movlw 0x8F
0006   0081           00103     movwf OPTION_REG
0007   0064           00104     clrwdt
                      00105         ;установка  максимального  времени
                      00106         ;срабатывания  сторожевого  таймера  и
                      00107         ;его сброс
0008   018B           00108     clrf INTCON
0009   018C           00109     clrf PIE1
000A   018D           00110     clrf PIE2
                      00111         ;отключение  прерываний  и  их  обработки
000B   3000           00112     movlw .0
000C   0086           00113     movwf TRISB
000D   0087           00114     movwf TRISC
000E   0089           00115     movwf TRISE
                      00116         ; конфигурирование  портов  В, С, Е
000F   30F8           00117     movlw b'11111000' 
0010   0085           00118     movwf TRISA 
0011   3000           00119     movlw b'00000000'
0012   0088           00120     movwf TRISD
0013   300F           00121     movlw b'00001111'
0014   0081           00122     movwf OPTION_REG
                      00123         ;конфигурирование  RD0  как  входа
                      00124         ;для  установки  на  нем  «1»  в  качестве
                      00125         ;исходного  состояния  интерфейса  «1-Wire»
0015   019F           00126     clrf ADCON1 
0016   149F           00127     bsf ADCON1,0x01 
0017   151F           00128     bsf ADCON1,0x02 
0018   1283           00129     bank0
0019   01BB           00130     clrf Key1    
001A   01BC           00131     clrf Key2       
001B   01BD           00132     clrf Key3       
001C   01BE           00133     clrf Key4              
001D   01C3           00134     clrf Key9               
001E   0187           00135     clrf PORTC
001F   0188           00136     clrf PORTD
                      00137 ; подготовка к передаче команд на контроллер
                      00138 ;HD путем установки RC0=0
0020   3001           00139     movlw 0x01
0021   2???           00140     call write
0022   300F           00141     movlw 0x0f
0023   2???           00142     call delay
                      00143 ; передача команды Clear  Display для очистки
                      00144 ;дисплея и установки счетчика адреса видеопа-
                      00145 ;мяти  на  нулевой  адрес  (первое  знакоместо  в
                      00146 ;верхней строке), с необходимой задержкой
0024   0064           00147     clrwdt
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0025   3038           00148     movlw 0x38
0026   2???           00149     call write
0027   300F           00150     movlw 0x0f
0028   2???           00151     call delay
                      00152 
                      00153 ; передача команды Function Set для установки
                      00154 ;режима  2-х  строчного  индикатора,  размера
                      00155 ;знакоместа 5х7 и 8 разрядной шины данных
0029   3006           00156     movlw 0x06
002A   2???           00157     call write
002B   300F           00158     movlw 0x0f
002C   2???           00159     call delay
                      00160 ;передача  команды  Entry  Mode  Set  для  уста-
                      00161 ;новки режима увеличения счетчика адреса ви-
                      00162 ;деопамяти, после каждой записи символа в нее,
                      00163 ;при неподвижности видеопамяти относительно
                      00164 ;индикатора
002D   300C           00165     movlw 0x0c
002E   2???           00166     call write
002F   300F           00167     movlw 0x0f
0030   2???           00168     call delay
                      00169 ;  передача  команды  Display  ON/OFF  control
                      00170 ;для включения дисплея с отключенным курсо-
                      00171 ;ром.  На  этом  этап инициализации дисплея за-
                      00172 ;кончен.
0031   3030           00173     movlw       0x30
0032   00B0           00174     movwf       TIME_HH1
0033   00B1           00175     movwf       TIME_HH2
0034   00B2           00176     movwf       TIME_MM1
0035   00B3           00177     movwf       TIME_MM2
0036   00B4           00178     movwf       TIME_SS1
0037   00B5           00179     movwf       TIME_SS2
0038   00B7           00180     movwf       ALARM_HH1
0039   00B8           00181     movwf       ALARM_HH2
003A   00B9           00182     movwf       ALARM_MM1
003B   00BA           00183     movwf       ALARM_MM2
003C   3000           00184     movlw       .0
003D   00B6           00185     movwf       DAY
003E   3000           00186     movlw       b'00000000'
003F   00D1           00187     movwf       Blink
                      00188 
0040                  00189 START
0040   0831           00190     movfw TIME_HH2              ; записываем значения постоянныx переменных в  временныe 
0041   00C6           00191     movwf TEMP_TIME_HH2         
0042   0830           00192     movfw TIME_HH1              
0043   00C5           00193     movwf TEMP_TIME_HH1
0044   0833           00194     movfw TIME_MM2              
0045   00C8           00195     movwf TEMP_TIME_MM2
0046   0832           00196     movfw TIME_MM1              
0047   00C7           00197     movwf TEMP_TIME_MM1
0048   0835           00198     movfw TIME_SS2              
0049   00CA           00199     movwf TEMP_TIME_SS2
004A   0834           00200     movfw TIME_SS1              
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

004B   00C9           00201     movwf TEMP_TIME_SS1
004C   0836           00202     movfw DAY
004D   00CB           00203     movwf TEMP_DAY
004E   3000           00204     movlw 0x00
004F   00D0           00205     movwf NumPressKey           ; NPK каждый раз устанавливаем в начальное значение
                      00206     
0050   2???           00207     call Keyboard               ; читаем клавиатуру
0051   183B           00208     btfsc Key1,0                ; проверка нажатия клавиши "1",  если нажата, то переходим 
0052   2???           00209     call time_plus_blink        ; к изменению времени, нет - тогда проверяем клавишу 2
0053   183C           00210     btfsc Key2,0                ; проверка нажатия клавиши "2",  если нажата, то переходим 
0054   2???           00211     goto change_day             ; к изменению дня недели, нет - тогда проверяем клавишу 3
                      00212         
0055   2???           00213     call LCD_one                ;Отрисовка первой строки                
                      00214 
                      00215         ;Счет десятков секунд (0-6) - TIME_SS1
0056   0AB4           00216     incf TIME_SS1,1
0057   303A           00217     movlw 0x3A                  ; if !=10
0058   0634           00218     xorwf TIME_SS1, w;
0059   1D03           00219     btfss STATUS, 0x02
005A   2???           00220     goto end_clock
                      00221         ;обнуление TIME_MM1
005B   3030           00222     movlw 0x30
005C   00B4           00223     movwf       TIME_SS1
                      00224 
                      00225         ;Счет десятков секунд (0-6) - TIME_SS2
005D   0AB5           00226     incf TIME_SS2,1
005E   3036           00227     movlw 0x36                  ; if !=6
005F   0635           00228     xorwf TIME_SS2, w;
0060   1D03           00229     btfss STATUS, 0x02
0061   2???           00230     goto end_clock
                      00231         ;обнуление TIME_MM2
0062   3030           00232     movlw 0x30
0063   00B5           00233     movwf       TIME_SS2
                      00234         
                      00235         ;Счет десятков минут (0-6) - TIME_MM1
0064   0AB2           00236     incf TIME_MM1,1
0065   303A           00237     movlw 0x3A                  ; if !=10
0066   0632           00238     xorwf TIME_MM1, w;
0067   1D03           00239     btfss STATUS, 0x02
0068   2???           00240     goto end_clock
                      00241         ;обнуление TIME_MM1
0069   3030           00242     movlw 0x30
006A   00B2           00243     movwf       TIME_MM1
                      00244 
                      00245         ;Счет десятков минут (0-6) - TIME_MM2
006B   0AB3           00246     incf TIME_MM2,1
006C   3036           00247     movlw 0x36                  ; if !=6
006D   0633           00248     xorwf TIME_MM2, w;
006E   1D03           00249     btfss STATUS, 0x02
006F   2???           00250     goto end_clock
                      00251         ;обнуление TIME_MM2
0070   3030           00252     movlw 0x30
0071   00B3           00253     movwf       TIME_MM2
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00254 
                      00255         ;Счет десятков единиц часов - TIME_НН2, TIME_НН1
0072   0AB0           00256     incf TIME_HH1,1
0073   3034           00257     movlw 0x34                  ; if !=4
0074   0630           00258     xorwf TIME_HH1, w;
0075   1D03           00259     btfss STATUS, 0x02
0076   2???           00260     goto ten_clock
0077   3032           00261     movlw 0x32                  ; if !=2
0078   0631           00262     xorwf TIME_HH2, w;
0079   1D03           00263     btfss STATUS, 0x02
007A   2???           00264     goto ten_clock
007B   3030           00265     movlw 0x30
007C   00B0           00266     movwf       TIME_HH1
007D   00B1           00267     movwf       TIME_HH2
007E   0AB6           00268     incf    DAY,1
007F   3007           00269     movlw       .7                      ; inc переменной День
0080   0636           00270     xorwf DAY, w;
0081   1D03           00271     btfss STATUS, 0x02                  ; Обнуление переменной при достижении воскресенья, 
0082   2???           00272     goto end_clock                      ; что бы при 00:00:00 перейти в понедельник
0083   3000           00273     movlw       .0
0084   00B6           00274     movwf       DAY
                      00275 
                      00276         
0085                  00277 ten_clock
0085   303A           00278     movlw 0x3A                  ; if !=10 
0086   0630           00279     xorwf TIME_HH1, w;          ; подпрограмма для работы с форматом 24 часа
0087   1D03           00280     btfss STATUS, 0x02          ; т.к. 18 часов может быть, а 28 нет, то надо
0088   2???           00281     goto end_clock              ; ограничить единицы при десятках = 2
Message[305]: Using default destination of 1 (file).
0089   0AB1           00282     incf    TIME_HH2
008A   3030           00283     movlw 0x30
008B   00B0           00284     movwf       TIME_HH1
                      00285         
008C                  00286 end_clock
008C   0064           00287     clrwdt
                      00288 
008D   30FF           00289     movlw 0xff
008E   2???           00290     call delay ;задержка крч
008F   30FF           00291     movlw 0xff
0090   2???           00292     call delay ;задержка крч
0091   30FF           00293     movlw 0xff
0092   2???           00294     call delay ;задержка крч
                      00295 
0093   2???           00296     call LCD_two                ;Отрисовка второй строки
                      00297     
                      00298     ; ТУТ ОБРАБОТКА БУДИЛЬНИКА БУДЕТ
                      00299     
0094   2???           00300     goto START          ; конец основного цикла (должен быть = 1сек)
                      00301 
                      00302     ;--------------------------------------------------------
                      00303     ;--------------------------------------------------------
                      00304     
                      00305      ; Процедура типа switch для выбора дня недели
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[305]: Using default destination of 1 (file).
0095   0782           00306 DEC addwf PCL
0096   2???           00307     goto monday
0097   2???           00308     goto tuesday
0098   2???           00309     goto wednesday      
0099   2???           00310     goto thursday    
009A   2???           00311     goto friday         
009B   2???           00312     goto saturday               
009C   2???           00313     goto sunday         
009D   0008           00314     return
                      00315 ;Отрисовка дней недели
009E                  00316 monday                      ;понедельник
009E   304D           00317     movlw 'M'
009F   2???           00318     call write
00A0   304F           00319     movlw 'O'
00A1   2???           00320     call write
00A2   304E           00321     movlw 'N'
00A3   2???           00322     call write
00A4   2???           00323     goto exday
00A5                  00324 tuesday                     ;вторник
00A5   3054           00325     movlw 'T'
00A6   2???           00326     call write
00A7   3055           00327     movlw 'U'
00A8   2???           00328     call write
00A9   3045           00329     movlw 'E'
00AA   2???           00330     call write
00AB   2???           00331     goto exday
00AC                  00332 wednesday                   ;среда
00AC   3057           00333     movlw 'W'
00AD   2???           00334     call write
00AE   3045           00335     movlw 'E'
00AF   2???           00336     call write
00B0   3044           00337     movlw 'D'
00B1   2???           00338     call write
00B2   2???           00339     goto exday
00B3                  00340 thursday                    ;четверг
00B3   3054           00341     movlw 'T'
00B4   2???           00342     call write
00B5   3048           00343     movlw 'H'
00B6   2???           00344     call write
00B7   3055           00345     movlw 'U'
00B8   2???           00346     call write
00B9   2???           00347     goto exday
00BA                  00348 friday                      ;пятница
00BA   3046           00349     movlw 'F'
00BB   2???           00350     call write
00BC   3052           00351     movlw 'R'
00BD   2???           00352     call write
00BE   3049           00353     movlw 'I'
00BF   2???           00354     call write
00C0   2???           00355     goto exday
00C1                  00356 saturday                    ;суббота
00C1   3053           00357     movlw 'S'
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00C2   2???           00358     call write
00C3   3041           00359     movlw 'A'
00C4   2???           00360     call write
00C5   3054           00361     movlw 'T'
00C6   2???           00362     call write
00C7   2???           00363     goto exday
00C8                  00364 sunday                      ;воскресенье
00C8   3053           00365     movlw 'S'
00C9   2???           00366     call write
00CA   3055           00367     movlw 'U'
00CB   2???           00368     call write
00CC   304E           00369     movlw 'N'
00CD   2???           00370     call write
00CE                  00371 exday
00CE   0008           00372     return
                      00373 
                      00374     ;--------------------------------------------------------
                      00375     
00CF                  00376 time_plus_blink                 ; инкремент переменной выбора и переход к изменению времени
00CF   0AD0           00377     incf NumPressKey,1
00D0   2???           00378     goto change_time
00D1   0008           00379     return
                      00380     
                      00381     ;--------------------------------------------------------
                      00382     
00D2                  00383 write    ; процедура записи байта к контроллер HD
00D2   1303           00384     bcf STATUS, RP1
00D3   1283           00385     bcf STATUS, RP0
00D4   0086           00386     movwf PORTB
00D5   1507           00387     bsf PORTC, 2
00D6   3001           00388     movlw 0x01
00D7   2???           00389     call delay
00D8   1107           00390     bcf PORTC, 2
00D9   0008           00391     return
                      00392     
                      00393         ; перед вызовом этой процедуры в W помеща-
                      00394         ;ется байт, который надо записать в HD. Далее
                      00395         ;он передается в PORTB и формируется отрица-
                      00396         ;тельный перепад на RC2, путем предваритель-
                      00397         ;ной  его  установки  в  «1»,  удержания  этого
                      00398         ;уровня в течение некоторого времени (опреде-
                      00399         ;ляемого временем задержки delay  при  W=1) и
                      00400         ;сброса его в «0».
                      00401 
                      00402         ;  процедура  задержки,  время  которой  можно
                      00403         ;регулировать, задавая число в W
00DA                  00404 delay
00DA   1303           00405     bcf   STATUS, RP1
00DB   1283           00406     bcf   STATUS, RP0
00DC   00A7           00407     movwf   fCOUNTER2
00DD   01A6           00408     clrf    fCOUNTER
                      00409     
00DE                  00410 BD_Loop
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00DE   0064           00411     clrwdt
00DF   0BA6           00412     decfsz  fCOUNTER, f
00E0   2???           00413     goto    BD_Loop
00E1   0BA7           00414     decfsz  fCOUNTER2, f
00E2   2???           00415     goto    BD_Loop
00E3   0008           00416     return
                      00417 
                      00418     ;==========================================
                      00419     
00E4                  00420 LCD_one
00E4   1007           00421     bcf PORTC, 0
00E5   3080           00422     movlw b'10000000'   ; установка адреса
00E6   2???           00423     call write
00E7   1407           00424     bsf PORTC,0
                      00425     ;Отрисовка первой строки
                      00426     ; Отрисовка Н2
00E8   2???           00427     call paintH2
                      00428     ; Отрисовка Н1
00E9   2???           00429     call paintH1
00EA   303A           00430     movlw ':'
00EB   2???           00431     call write
                      00432     ; Отрисовка М2
00EC   2???           00433     call paintM2
                      00434     ; Отрисовка М1
00ED   2???           00435     call paintM1
00EE   303A           00436     movlw ':'
00EF   2???           00437     call write
                      00438     ; Отрисовка S2
00F0   2???           00439     call paintS2
                      00440     ; Отрисовка S1
00F1   2???           00441     call paintS1
00F2   3020           00442     movlw ' '
00F3   2???           00443     call write
00F4   3020           00444     movlw ' '
00F5   2???           00445     call write
00F6   0836           00446     movfw       DAY                             
00F7   2???           00447     call        DEC
                      00448 
00F8   0008           00449     return
                      00450     
                      00451     ;==========================================
                      00452     
                      00453     ; Собственно механизм последовательного моргания при настройке времени
00F9                  00454 paintH2
00F9   3001           00455     movlw 0x1                   ; если NumPressKey = 0, то вызываем
00FA   0650           00456     xorwf NumPressKey, w;       
00FB   1D03           00457     btfss STATUS, 0x02          
00FC   2???           00458     goto blink_on_H2
00FD   0AD1           00459     incf Blink,1
00FE   1C51           00460     btfss Blink, 0
00FF   2???           00461     goto blink_on_H2
0100   2???           00462     goto blink_off_H2
0101                  00463 blink_off_H2
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0101   3020           00464     movlw ' '
0102   2???           00465     call write
0103   0008           00466     return
0104                  00467 blink_on_H2
0104   0831           00468     movfw TIME_HH2
0105   2???           00469     call write
0106   0008           00470     return
                      00471     ;-----------
0107                  00472 paintH1
0107   3002           00473     movlw 0x2                   ; если NumPressKey = 0, то вызываем
0108   0650           00474     xorwf NumPressKey, w;       
0109   1D03           00475     btfss STATUS, 0x02          
010A   2???           00476     goto blink_on_H1
010B   0AD1           00477     incf Blink,1
010C   1C51           00478     btfss Blink, 0
010D   2???           00479     goto blink_on_H1
010E   2???           00480     goto blink_off_H1
010F                  00481 blink_off_H1
010F   3020           00482     movlw ' '
0110   2???           00483     call write
0111   0008           00484     return
0112                  00485 blink_on_H1
0112   0830           00486     movfw TIME_HH1
0113   2???           00487     call write
0114   0008           00488     return
                      00489     ;------------
0115                  00490 paintM2
0115   3003           00491     movlw 0x3                   ; если NumPressKey = 0, то вызываем
0116   0650           00492     xorwf NumPressKey, w;       
0117   1D03           00493     btfss STATUS, 0x02          
0118   2???           00494     goto blink_on_M2
0119   0AD1           00495     incf Blink,1
011A   1C51           00496     btfss Blink, 0
011B   2???           00497     goto blink_on_M2
011C   2???           00498     goto blink_off_M2
011D                  00499 blink_off_M2
011D   3020           00500     movlw ' '
011E   2???           00501     call write
011F   0008           00502     return
0120                  00503 blink_on_M2
0120   0833           00504     movfw TIME_MM2
0121   2???           00505     call write
0122   0008           00506     return
                      00507     ;------------
0123                  00508 paintM1
0123   3004           00509     movlw 0x4                   ; если NumPressKey = 0, то вызываем
0124   0650           00510     xorwf NumPressKey, w;       
0125   1D03           00511     btfss STATUS, 0x02          
0126   2???           00512     goto blink_on_M1
0127   0AD1           00513     incf Blink,1
0128   1C51           00514     btfss Blink, 0
0129   2???           00515     goto blink_on_M1
012A   2???           00516     goto blink_off_M1
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

012B                  00517 blink_off_M1
012B   3020           00518     movlw ' '
012C   2???           00519     call write
012D   0008           00520     return
012E                  00521 blink_on_M1
012E   0832           00522     movfw TIME_MM1
012F   2???           00523     call write
0130   0008           00524     return
                      00525     ;------------
0131                  00526 paintS2
0131   3005           00527     movlw 0x5                   ; если NumPressKey = 0, то вызываем
0132   0650           00528     xorwf NumPressKey, w;       
0133   1D03           00529     btfss STATUS, 0x02          
0134   2???           00530     goto blink_on_S2
0135   0AD1           00531     incf Blink,1
0136   1C51           00532     btfss Blink, 0
0137   2???           00533     goto blink_on_S2
0138   2???           00534     goto blink_off_S2
0139                  00535 blink_off_S2
0139   3020           00536     movlw ' '
013A   2???           00537     call write
013B   0008           00538     return
013C                  00539 blink_on_S2
013C   0835           00540     movfw TIME_SS2
013D   2???           00541     call write
013E   0008           00542     return
                      00543     ;------------
013F                  00544 paintS1
013F   3006           00545     movlw 0x6                   ; если NumPressKey = 0, то вызываем
0140   0650           00546     xorwf NumPressKey, w;       
0141   1D03           00547     btfss STATUS, 0x02          
0142   2???           00548     goto blink_on_S1
0143   0AD1           00549     incf Blink,1
0144   1C51           00550     btfss Blink, 0
0145   2???           00551     goto blink_on_S1
0146   2???           00552     goto blink_off_S1
0147                  00553 blink_off_S1
0147   3020           00554     movlw ' '
0148   2???           00555     call write
0149   0008           00556     return
014A                  00557 blink_on_S1
014A   0834           00558     movfw TIME_SS1
014B   2???           00559     call write
014C   0008           00560     return
                      00561     ;==========================================   
                      00562     
014D                  00563 LCD_two
014D   1007           00564     bcf PORTC, 0
014E   30C4           00565     movlw b'11000100'
014F   2???           00566     call write
                      00567 ; Установка RC0=0, для последующей передачи
                      00568 ;команды  на  контроллер  HD.  Передается  ко-
                      00569 ;манда Set DDRAM address,  устанавливающая
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00570 ;счетчик  адреса  видеопамяти  на  начало  2-ой
                      00571 ;строки:  ячейку  с  адресом  (0х40  =  0100  0000).
                      00572 ;Это  необходимо  для  вывода  фразы  «TEM-
                      00573 ;PERATURA =» на второй строке индикатора.
                      00574 
0150   1407           00575     bsf PORTC,0  ; установка RC0=1, для последующей передачи
                      00576 ;кодов символов второй строки на дисплей. Об-
                      00577 ;ратите внимание на то, что нигде не требуется
                      00578 ;изменения  банков  памяти: т.к. все регистры, с
                      00579 ;которыми работает ПО, находятся в 0-ом бан-
                      00580 ;ке.
0151   3041           00581     movlw 'A'
0152   2???           00582     call write
0153   304C           00583     movlw 'L'
0154   2???           00584     call write
0155   3041           00585     movlw 'A'
0156   2???           00586     call write
0157   3052           00587     movlw 'R'
0158   2???           00588     call write
0159   304D           00589     movlw 'M'
015A   2???           00590     call write
015B   3020           00591     movlw ' '
015C   2???           00592     call write
015D   3020           00593     movlw ' '
015E   2???           00594     call write
015F   0838           00595     movfw ALARM_HH2
0160   2???           00596     call write
0161   0837           00597     movfw ALARM_HH1
0162   2???           00598     call write
0163   303A           00599     movlw ':'
0164   2???           00600     call write
0165   083A           00601     movfw ALARM_MM2
0166   2???           00602     call write
0167   0839           00603     movfw ALARM_MM1
0168   2???           00604     call write
0169   0008           00605     return
                      00606  
                      00607      ;==========================================
                      00608      
                      00609     
016A                  00610 Keyboard                    ; драйвер клавиатуры для клавиш 1-4, 9
016A   1283           00611     bcf STATUS, RP0         ; переход в нулевой банк, для нормального вызова функции из тела программы
016B   1303           00612     bcf STATUS, RP1
016C   01BB           00613     clrf Key1               ; обнуление кодов клавиш
016D   01BC           00614     clrf Key2 
016E   01BD           00615     clrf Key3
016F   01BE           00616     clrf Key4  
0170   01C3           00617     clrf Key9  
0171                  00618 col1                        ; сканируем первый столбец, где нам нужны клавиши 1, 4
0171   1405           00619     bsf PORTA,0             ; подача питания
0172   1085           00620     bcf PORTA,1
0173   1105           00621     bcf PORTA,2 
                      00622     ;movlw .24
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00623     ;call small_delay
0174   0805           00624     movf PORTA,W            ; читаем порт А в W и выполняем поразрядное умножение битов порта на число 0
                            011 1000.
0175   3938           00625     andlw 0x38
0176   1903           00626     btfsc STATUS,Z          ; если Z=1 (т.е. не нажата ни одна из кнопок) переходим на метку col2
0177   2???           00627     goto col2               ; для сканирования второго столбца клавиатуры. Если Z=0, то пропускаем строк
                            у
                      00628     ;movlw .250
                      00629     ;call small_delay  
0178   1985           00630     btfsc PORTA,3           ; определяем нажатия клавиши "1", проводя опрос первой строки
0179   0ABB           00631     incf Key1,F
017A   1A05           00632     btfsc PORTA,4           ; определяем нажатия клавиши "4", проводя опрос второй строки
017B   0ABE           00633     incf Key4,F
Warning[207]: Found label after column 1. (col2)
017C                  00634     col2                    ; сканируем второй столбец, где нам нужна клавиша 2
017C   1005           00635     bcf PORTA,0             ; подача питания
017D   1485           00636     bsf PORTA,1
017E   1105           00637     bcf PORTA,2 
                      00638     ;movlw .24
                      00639     ;sd
017F   0805           00640     movf PORTA,W            ; читаем порт А в W и выполняем поразрядное умножение битов порта на число 0
                            011 1000.
0180   3938           00641     andlw 0x38
0181   1903           00642     btfsc STATUS,Z          ; если Z=1 (т.е. не нажата ни одна из кнопок) переходим на метку col3
0182   2???           00643     goto col3               ; для сканирования третьего столбца клавиатуры. Если Z=0, то пропускаем стро
                            ку
                      00644     ;movlw .250
                      00645     ;sd
0183   1985           00646     btfsc PORTA,3           ; определяем нажатия клавиши "2", проводя опрос первой строки
0184   0ABC           00647     incf Key2,F
0185                  00648 col3                ; сканируем третий столбец, где нам нужна клавиша 3
0185   1005           00649     bcf PORTA,0             ; подача питания
0186   1085           00650     bcf PORTA,1
0187   1505           00651     bsf PORTA,2
                      00652     ;movlw .24
                      00653     ;sd
0188   0805           00654     movf PORTA,W            ; читаем порт А в W и выполняем поразрядное умножение битов порта на число 0
                            011 1000.
0189   3938           00655     andlw 0x38
018A   1903           00656     btfsc STATUS,Z          ; если Z=1 (т.е. не нажата ни одна из кнопок) выходим из функции
018B   0008           00657     return                  ; если Z=0, то пропускаем строку
                      00658     ;movlw .250
                      00659     ;sd
018C   1985           00660     btfsc PORTA,3           ; определяем нажатия клавиши "3", проводя опрос первой строки
018D   0ABD           00661     incf Key3,F
018E   1A85           00662     btfsc PORTA,5           ; определяем нажатия клавиши "9", проводя опрос третей строки
018F   0AC3           00663     incf Key9,F
0190   0008           00664     return                  ; выход из функции
                      00665     
                      00666 ;==============================================
                      00667 
0191                  00668 change_time                 ; функция изменения времени
0191   2???           00669     call Keyboard           ; спрашиваем клавиатуру
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0192   183B           00670     btfsc Key1,0
0193   2???           00671     call correct_T_plus     ; если нажали кнопку 1 переходим в функцию, которая инкрементирует выбранное
                             число (inc)
0194   183C           00672     btfsc Key2,0
0195   2???           00673     call correct_T_minus    ; если нажали кнопку 2 переходим в функцию, которая декрементирует выбранное
                             число (dec)
0196   183D           00674     btfsc Key3,0
0197   2???           00675     goto save_T             ; переход к другой цифре путем инкремента NPK, при переполнения переменной п
                            роисходит сохранение результата и выход в основной цикл
0198   183E           00676     btfsc Key4,0            ; выход из настройки времени в основной цикл без сохранения результата
0199   2???           00677     goto change_HMS
                      00678     
019A   2???           00679     call LCD_one
019B   2???           00680     goto change_time
                      00681     
                      00682     ;----------------------------------------
                      00683     
019C                  00684 correct_T_plus                  ; функция типа switch для ввода отдельных символов(инкремент или прибавл
                            ение)
019C   30FF           00685     movlw 0xff
019D   2???           00686     call delay                  ; задержка крч
019E   30FF           00687     movlw 0xff
019F   2???           00688     call delay                  ; задержка крч                      
01A0   3001           00689     movlw 0x1                   ; если NumPressKey = 0, то вызываем
01A1   0650           00690     xorwf NumPressKey, w;       ; функцию коррекции переменной Н2.
01A2   1903           00691     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01A3   2???           00692     call correct_H2
                      00693     
01A4   3002           00694     movlw 0x2                   ; если NumPressKey = 1, то вызываем
01A5   0650           00695     xorwf NumPressKey, w;       ; функцию коррекции переменной Н1.
01A6   1903           00696     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01A7   2???           00697     call correct_H1
                      00698 
01A8   3003           00699     movlw 0x3                   ; если NumPressKey = 2, то вызываем
01A9   0650           00700     xorwf NumPressKey, w;       ; функцию коррекции переменной M2.
01AA   1903           00701     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01AB   2???           00702     call correct_M2
                      00703     
01AC   3004           00704     movlw 0x4                   ; если NumPressKey = 3, то вызываем
01AD   0650           00705     xorwf NumPressKey, w;       ; функцию коррекции переменной M1.
01AE   1903           00706     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01AF   2???           00707     call correct_M1
                      00708     
01B0   3005           00709     movlw 0x5                   ; если NumPressKey = 4, то вызываем
01B1   0650           00710     xorwf NumPressKey, w;       ; функцию коррекции переменной S2.
01B2   1903           00711     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01B3   2???           00712     call correct_S2
                      00713     
01B4   3006           00714     movlw 0x6                   ; если NumPressKey = 5, то вызываем
01B5   0650           00715     xorwf NumPressKey, w;       ; функцию коррекции переменной S1.
01B6   1903           00716     btfsc STATUS, 0x02          ; если нет, выходим из функции
01B7   2???           00717     call correct_S1
                      00718     
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01B8   0008           00719     return
                      00720     
                      00721     ;----------------------------------------
                      00722     
01B9                  00723 correct_H2                      ; функцию коррекции переменной H2.
01B9   0AB1           00724     incf TIME_HH2,1     ; инкремент временной переменной для Н2
01BA   3033           00725     movlw 0x33                  ; if !=3, переходим обратно в функцию
01BB   0631           00726     xorwf TIME_HH2, w   ; correct_T_plus и проверяем там следующее условие
01BC   1D03           00727     btfss STATUS, 0x02
01BD   0008           00728     return
01BE   3030           00729     movlw       0x30            ; Если переменная = 3, то обнуляем ее, т.к. в сутках 2 десятка часов
01BF   00B1           00730     movwf       TIME_HH2
01C0   0008           00731     return                      ; и идем обратно в correct_T_plus и проверяем там следующее условие
                      00732     
01C1                  00733 correct_H1                      ; функцию коррекции переменной H1.
01C1   0AB0           00734     incf TIME_HH1,1     ; инкремент временной переменной для Н1
01C2   3032           00735     movlw 0x32                  ; if = 2, переходим в функцию three_H1, которая служит для 
01C3   0631           00736     xorwf TIME_HH2, w   ; корректной задачи времени, т.к. 18 часов может быть, а 28 нет, то надо
                      00737                                 ; ограничить единицы при десятках = 2   
01C4   1903           00738     btfsc STATUS, 0x02
01C5   2???           00739     goto three_H1                       
01C6   303A           00740     movlw 0x3a                  ; есди переменная = 0 или = 1, то максимальная единица для обноления - 9
                            .
01C7   0630           00741 t1  xorwf TIME_HH1, w   
01C8   1D03           00742     btfss STATUS, 0x02
01C9   0008           00743     return
01CA   3030           00744     movlw       0x30            ; собственно обнуление переменной при достижении 10 или 4 по условию выш
                            е. 
01CB   00B0           00745     movwf       TIME_HH1
01CC   0008           00746     return
                      00747     
01CD                  00748 three_H1
01CD   3034           00749     movlw 0x34                  ; предел для обнуления при переменной = 2
01CE   2???           00750     goto t1                     ; возврат к метке t1 для продолжения корректной работы
                      00751     
01CF                  00752 correct_M2                      ; функцию коррекции переменной M2.
01CF   0AB3           00753     incf TIME_MM2,1
01D0   3036           00754     movlw 0x36                  ; Работает так же, только обнуление происходит при достижении 6
01D1   0633           00755     xorwf TIME_MM2, w;
01D2   1D03           00756     btfss STATUS, 0x02
01D3   0008           00757     return
01D4   3030           00758     movlw       0x30
01D5   00B3           00759     movwf       TIME_MM2
01D6   0008           00760     return
                      00761     
01D7                  00762 correct_M1                      ; функцию коррекции переменной M1.
01D7   0AB2           00763     incf TIME_MM1,1
01D8   303A           00764     movlw 0x3a                  ; Работает так же, только обнуление происходит при достижении 10
01D9   0632           00765     xorwf TIME_MM1, w;
01DA   1D03           00766     btfss STATUS, 0x02
01DB   0008           00767     return
01DC   3030           00768     movlw       0x30
01DD   00B2           00769     movwf       TIME_MM1
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01DE   0008           00770     return
                      00771     
01DF                  00772 correct_S2                      ; функцию коррекции переменной S2.
01DF   0AB5           00773     incf TIME_SS2,1
01E0   3036           00774     movlw 0x36                  ; Работает так же, только обнуление происходит при достижении 6
01E1   0635           00775     xorwf TIME_SS2, w;
01E2   1D03           00776     btfss STATUS, 0x02
01E3   0008           00777     return
01E4   3030           00778     movlw       0x30
01E5   00B5           00779     movwf       TIME_SS2
01E6   0008           00780     return
                      00781     
01E7                  00782 correct_S1                      ; функцию коррекции переменной S1.
01E7   0AB4           00783     incf TIME_SS1,1
01E8   303A           00784     movlw 0x3a                  ; Работает так же, только обнуление происходит при достижении 10
01E9   0634           00785     xorwf TIME_SS1, w;
01EA   1D03           00786     btfss STATUS, 0x02
01EB   0008           00787     return
01EC   3030           00788     movlw       0x30
01ED   00B4           00789     movwf       TIME_SS1
01EE   0008           00790     return
                      00791     
                      00792     ;----------------------------------------
                      00793     
01EF                  00794 correct_T_minus                 ; функция типа switch для ввода отдельных символов(декремент)
01EF   30FF           00795     movlw 0xff
01F0   2???           00796     call delay              ; задержка крч
01F1   30FF           00797     movlw 0xff
01F2   2???           00798     call delay              ; задержка крч
01F3   3001           00799     movlw 0x1                   ; если NumPressKey = 0, то вызываем
01F4   0650           00800     xorwf NumPressKey, w;       ; функцию коррекции переменной Н2.
01F5   1903           00801     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01F6   2???           00802     call correct_H2_minus
                      00803     
01F7   3002           00804     movlw 0x2                   ; если NumPressKey = 1, то вызываем
01F8   0650           00805     xorwf NumPressKey, w;       ; функцию коррекции переменной Н1.
01F9   1903           00806     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01FA   2???           00807     call correct_H1_minus
                      00808 
01FB   3003           00809     movlw 0x3                   ; если NumPressKey = 2, то вызываем
01FC   0650           00810     xorwf NumPressKey, w;       ; функцию коррекции переменной M2.
01FD   1903           00811     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
01FE   2???           00812     call correct_M2_minus
                      00813     
01FF   3004           00814     movlw 0x4                   ; если NumPressKey = 3, то вызываем
0200   0650           00815     xorwf NumPressKey, w;       ; функцию коррекции переменной M1.
0201   1903           00816     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
0202   2???           00817     call correct_M1_minus
                      00818     
0203   3005           00819     movlw 0x5                   ; если NumPressKey = 4, то вызываем
0204   0650           00820     xorwf NumPressKey, w;       ; функцию коррекции переменной S2.
0205   1903           00821     btfsc STATUS, 0x02          ; если нет, проверяем следующее условие
0206   2???           00822     call correct_S2_minus
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00823     
0207   3006           00824     movlw 0x6                   ; если NumPressKey = 5, то вызываем
0208   0650           00825     xorwf NumPressKey, w;       ; функцию коррекции переменной S1.
0209   1903           00826     btfsc STATUS, 0x02          ; если нет, выходим из функции
020A   2???           00827     call correct_S1_minus
                      00828     
020B   0008           00829     return
                      00830     
                      00831     ;----------------------------------------
                      00832     
020C                  00833 correct_H2_minus                ; функцию коррекции переменной H2.
020C   03B1           00834     decf TIME_HH2,1     ; декремент временной переменной для Н2
020D   302F           00835     movlw 0x2f                  ; if !=2f, переходим обратно в функцию
020E   0631           00836     xorwf TIME_HH2, w   ; correct_T_ и проверяем там следующее условие
020F   1D03           00837     btfss STATUS, 0x02
0210   0008           00838     return
0211   3032           00839     movlw       0x32            ; Если переменная = 2f, то присваиваем ей значение 2, т.к. в сутках 2 де
                            сятка часов
0212   00B1           00840     movwf       TIME_HH2
0213   0008           00841     return                      ; и идем обратно в correct_T_ и проверяем там следующее условие
                      00842     
0214                  00843 correct_H1_minus                ; функцию коррекции переменной H1.
0214   03B0           00844     decf TIME_HH1,1     ; декремент временной переменной для Н1
0215   302F           00845     movlw 0x2f                  ; if != 2f, переходим обратно в функцию 
0216   0630           00846     xorwf TIME_HH1, w   ; correct_T_ и проверяем там следующее условие
                      00847                                         
0217   1D03           00848     btfss STATUS, 0x02
0218   0008           00849     return              
0219   3032           00850     movlw 0x32                  ; есди переменная = 2, то при достижении 2f будем присваивать Н1 = 3.
021A   0631           00851     xorwf TIME_HH2, w   
021B   1903           00852     btfsc STATUS, 0x02
021C   2???           00853     goto three_H1_minus
021D   3039           00854     movlw       0x39            ; есди переменная != 2, то при достижении 2f будем присваивать Н1 = 9. 
021E   00B0           00855 t2  movwf       TIME_HH1
021F   0008           00856     return
                      00857     
0220                  00858 three_H1_minus
0220   3033           00859     movlw 0x33                  ; значение для присваивания при Н2 = 2.
0221   2???           00860     goto t2                     ; возврат к метке t2 для продолжения корректной работы
                      00861     
0222                  00862 correct_M2_minus                        ; функцию коррекции переменной M2.
0222   03B3           00863     decf TIME_MM2,1
0223   302F           00864     movlw 0x2f                  ; Работает так же, только при достижении 2f присваивается 5
0224   0633           00865     xorwf TIME_MM2, w;
0225   1D03           00866     btfss STATUS, 0x02
0226   0008           00867     return
0227   3035           00868     movlw       0x35
0228   00B3           00869     movwf       TIME_MM2
0229   0008           00870     return
                      00871     
022A                  00872 correct_M1_minus                        ; функцию коррекции переменной M1.
022A   03B2           00873     decf TIME_MM1,1
022B   302F           00874     movlw 0x2f                  ; Работает так же, только при достижении 2f присваивается 10
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

022C   0632           00875     xorwf TIME_MM1, w;
022D   1D03           00876     btfss STATUS, 0x02
022E   0008           00877     return
022F   3039           00878     movlw       0x39
0230   00B2           00879     movwf       TIME_MM1
0231   0008           00880     return
                      00881     
0232                  00882 correct_S2_minus                        ; функцию коррекции переменной S2.
0232   03B5           00883     decf TIME_SS2,1
0233   302F           00884     movlw 0x2f                  ; Работает так же, только при достижении 2f присваивается 5
0234   0635           00885     xorwf TIME_SS2, w;
0235   1D03           00886     btfss STATUS, 0x02
0236   0008           00887     return
0237   3035           00888     movlw       0x35
0238   00B5           00889     movwf       TIME_SS2
0239   0008           00890     return
                      00891     
023A                  00892 correct_S1_minus                        ; функцию коррекции переменной S1.
023A   03B4           00893     decf TIME_SS1,1
023B   302F           00894     movlw 0x2f                  ; Работает так же, только при достижении 2f присваивается 10
023C   0634           00895     xorwf TIME_SS1, w;
023D   1D03           00896     btfss STATUS, 0x02
023E   0008           00897     return
023F   3039           00898     movlw       0x39
0240   00B4           00899     movwf       TIME_SS1
0241   0008           00900     return
                      00901     
                      00902     ;==============================================
                      00903     
0242                  00904 save_T                          ; функция проверки и сохранения времени
0242   30FF           00905     movlw 0xff
0243   2???           00906     call delay                  ; задержка крч
0244   30FF           00907     movlw 0xff
0245   2???           00908     call delay                  ; задержка крч
0246   3006           00909     movlw 0x6                   ; если происходит переполнение NumPressKey
0247   0650           00910     xorwf NumPressKey, w        ; значит время заданно корректно во всех ячейках
0248   1903           00911     btfsc STATUS, 0x02          ; и мы переходим в функцию записи переменных значений
0249   2???           00912     goto START                  ; в постоянные
024A   0AD0           00913     incf NumPressKey,1          ; Если NumPressKey не переполнен, то инкрементируем
024B   2???           00914     goto change_time            ; его и возвращаемся в функцию изменения времени
                      00915     
024C                  00916 change_HMS
024C   0846           00917     movfw TEMP_TIME_HH2         ; записываем значения временных переменных в постоянные (NPK 
024D   00B1           00918     movwf TIME_HH2              ; необходим для определения ячейки, в которую записываем
024E   0845           00919     movfw TEMP_TIME_HH1         ; значение)
024F   00B0           00920     movwf TIME_HH1
0250   0848           00921     movfw TEMP_TIME_MM2         
0251   00B3           00922     movwf TIME_MM2
0252   0847           00923     movfw TEMP_TIME_MM1         
0253   00B2           00924     movwf TIME_MM1
0254   084A           00925     movfw TEMP_TIME_SS2         
0255   00B5           00926     movwf TIME_SS2
0256   0849           00927     movfw TEMP_TIME_SS1         
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0257   00B4           00928     movwf TIME_SS1
0258   2???           00929     goto START                  ; возврат в основной цикл
                      00930     
                      00931     ;==============================================
                      00932     ;==============================================
                      00933     ;==============================================
                      00934     
0259                  00935 change_day                  ; функция изменения дня недели
0259   2???           00936     call Keyboard
025A   183B           00937     btfsc Key1,0
025B   2???           00938     goto plus_day_ch        ; если нажали кнопку 1 переходим в функцию, которая инкрементирует выбранное
                             число (inc)
025C   183C           00939     btfsc Key2,0
025D   2???           00940     goto minus_day_ch       ; если нажали кнопку 2 переходим в функцию, которая декрементирует выбранное
                             число (dec)
025E   183E           00941     btfsc Key4,0            ; выход из настройки времени в основной цикл без сохранения результата
025F   2???           00942     goto START
                      00943     
0260   1007           00944     bcf PORTC, 0
0261   308A           00945     movlw b'10001010'   ; установка адреса
0262   2???           00946     call write
0263   1407           00947     bsf PORTC,0
                      00948 
                      00949         ;Отрисовка первой строки
0264   084B           00950     movfw       TEMP_DAY                                
0265   2???           00951     call        DEC
                      00952     
0266   2???           00953     goto change_day
                      00954     
0267                  00955 plus_day_ch
0267   30FF           00956     movlw 0xff
0268   2???           00957     call delay              ; задержка крч
0269   30FF           00958     movlw 0xff
026A   2???           00959     call delay              ; задержка крч
026B   0ACB           00960     incf    TEMP_DAY,1
026C   3007           00961     movlw       .7                      ; inc переменной День
026D   064B           00962     xorwf TEMP_DAY, w;
026E   1D03           00963     btfss STATUS, 0x02          ; is not working 
026F   2???           00964     goto change_day                     ; 
0270   3000           00965     movlw       .0
0271   00CB           00966     movwf       TEMP_DAY
0272   2???           00967     goto change_day
                      00968     
0273                  00969 minus_day_ch
0273   30FF           00970     movlw 0xff
0274   2???           00971     call delay              ; задержка крч
0275   30FF           00972     movlw 0xff
0276   2???           00973     call delay              ; задержка крч
0277   0ACB           00974     incf    TEMP_DAY,1
0278   3000           00975     movlw       .0                      ; inc переменной День
0279   064B           00976     xorwf TEMP_DAY, w;
027A   1D03           00977     btfss STATUS, 0x02          ; is not working 
027B   2???           00978     goto change_day                     
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

027C   3006           00979     movlw       .6
027D   00CB           00980     movwf       TEMP_DAY
027E   2???           00981     goto change_day
                      00982     
                      00983     ;==============================================
                      00984     ;==============================================
                      00985     ;==============================================
                      00986                             
                      00987 ;small_delay:                   ; задержка для драйвера
                      00988 ;    movwf fCOUNTER1
                      00989 ;    clrwdt
                      00990 ;    decfsz fCOUNTER1,F
                      00991 ;    goto $-2
                      00992 ;    return
                      00993     
Warning[205]: Found directive in column 1. (end)
                      00994 end  ; конец программы
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ALARM_HH1                         00000037
ALARM_HH2                         00000038
ALARM_MM1                         00000039
ALARM_MM2                         0000003A
BCLIE                             00000003
BCLIF                             00000003
BD_Loop                           000000DE
BF                                00000000
BRGH                              00000002
Blink                             00000051
C                                 00000000
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CKE                               00000006
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

CKP                               00000004
CREN                              00000004
CSRC                              00000007
D                                 00000005
DATA_ADDRESS                      00000005
DAY                               00000036
DC                                00000001
DEC                               00000095
DS                                00000002
D_A                               00000005
D_NOT_A                           00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GO_NOT_DONE                       00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
Key1                              0000003B
Key2                              0000003C
Key3                              0000003D
Key4                              0000003E
Key5                              0000003F
Key6                              00000040
Key7                              00000041
Key8                              00000042
Key9                              00000043
Keyboard                          0000016A
LCD_one                           000000E4
LCD_two                           0000014D
NOT_A                             00000005
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 23


SYMBOL TABLE
  LABEL                             VALUE 

NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
NumPressKey                       00000050
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 24


SYMBOL TABLE
  LABEL                             VALUE 

RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RST                               00000002
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SEN                               00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 25


SYMBOL TABLE
  LABEL                             VALUE 

SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
START                             00000040
STATUS                            00000003
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TEMP_ALARM_HH1                    0000004C
TEMP_ALARM_HH2                    0000004D
TEMP_ALARM_MM1                    0000004E
TEMP_ALARM_MM2                    0000004F
TEMP_DAY                          0000004B
TEMP_TIME_HH1                     00000045
TEMP_TIME_HH2                     00000046
TEMP_TIME_MM1                     00000047
TEMP_TIME_MM2                     00000048
TEMP_TIME_SS1                     00000049
TEMP_TIME_SS2                     0000004A
TIME_HH1                          00000030
TIME_HH2                          00000031
TIME_MM1                          00000032
TIME_MM2                          00000033
TIME_SS1                          00000034
TIME_SS2                          00000035
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 27


SYMBOL TABLE
  LABEL                             VALUE 

TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
W                                 00000000
WAIT                              00000020
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00000FCF
_CP_HALF                          00001FDF
_CP_OFF                           00003FFF
_CP_UPPER_256                     00002FEF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_ENABLE_OFF                   00003DFF
_WRT_ENABLE_ON                    00003FFF
_WRT_OFF                          00003DFF
_WRT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F877                          00000001
bank0                             bcf STATUS,  RP0
bank1                             bsf STATUS,  RP0
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 28


SYMBOL TABLE
  LABEL                             VALUE 

begin                             00000004
blink_off_H1                      0000010F
blink_off_H2                      00000101
blink_off_M1                      0000012B
blink_off_M2                      0000011D
blink_off_S1                      00000147
blink_off_S2                      00000139
blink_on_H1                       00000112
blink_on_H2                       00000104
blink_on_M1                       0000012E
blink_on_M2                       00000120
blink_on_S1                       0000014A
blink_on_S2                       0000013C
change_HMS                        0000024C
change_day                        00000259
change_time                       00000191
col1                              00000171
col2                              0000017C
col3                              00000185
correct_H1                        000001C1
correct_H1_minus                  00000214
correct_H2                        000001B9
correct_H2_minus                  0000020C
correct_M1                        000001D7
correct_M1_minus                  0000022A
correct_M2                        000001CF
correct_M2_minus                  00000222
correct_S1                        000001E7
correct_S1_minus                  0000023A
correct_S2                        000001DF
correct_S2_minus                  00000232
correct_T_minus                   000001EF
correct_T_plus                    0000019C
delay                             000000DA
end_clock                         0000008C
exday                             000000CE
fCOUNTER                          00000026
fCOUNTER1                         00000044
fCOUNTER2                         00000027
friday                            000000BA
minus_day_ch                      00000273
monday                            0000009E
paintH1                           00000107
paintH2                           000000F9
paintM1                           00000123
paintM2                           00000115
paintS1                           0000013F
paintS2                           00000131
plus_day_ch                       00000267
saturday                          000000C1
save_T                            00000242
sunday                            000000C8
t1                                000001C7
MPASM 5.75                          MAIN.ASM   10-23-2017  16:29:10         PAGE 29


SYMBOL TABLE
  LABEL                             VALUE 

t2                                0000021E
ten_clock                         00000085
three_H1                          000001CD
three_H1_minus                    00000220
thursday                          000000B3
time_plus_blink                   000000CF
tuesday                           000000A5
wait                              
wednesday                         000000AC
write                             000000D2

Errors   :     0
Warnings :     4 reported,     0 suppressed
Messages :     2 reported,    12 suppressed

